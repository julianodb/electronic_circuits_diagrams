name: CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: LaTeX compilation
        uses: dante-ev/latex-action@2021-A
        with:
          root_file: diode.tex
          working_directory: src
          # LaTeX engine to be used
          compiler: pdflatex
          # Extra arguments to be passed to the latex compiler
          args: -interaction=nonstopmode -shell-escape # optional, default is -pdf -latexoption=-file-line-error -latexoption=-interaction=nonstopmode

      - name: Push generated files to branch 'gh-pages'
        run: |
          mkdir -p static
          mv src/*.pdf static
          mv src/*.png static
          cd static
          git init -b main
          git config user.name $GITHUB_ACTOR
          git config user.email $GITHUB_ACTOR@users.noreply.github.com
          git remote add origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/$GITHUB_REPOSITORY
          git add .
          git commit -m "[release] Publish on GitHub Pages"
          git push --force origin main:gh-pages
